# é›†åˆ

## ä¸€ã€é›†åˆå¼•å…¥

Javaæ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œæ­¤æ—¶éœ€è¦ä¸€ä¸ªå®¹å™¨å­˜å¯¹è±¡è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

* ä½¿ç”¨`StringBuffer`ã€`StringBuilder`ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼è¿”å›çš„éƒ½æ˜¯å­—ç¬¦ä¸²
* ä½¿ç”¨å¯¹è±¡æ•°ç»„ï¼Œä½†æ•°ç»„çš„é•¿åº¦å›ºå®šä¸”åªèƒ½æ˜¯åŒä¸€æ•°æ®ç±»å‹

å¯è§æ²¡æœ‰ä¸€ç§æ›´å¥½çš„å®¹å™¨æ¥å­˜å‚¨å¯¹è±¡ï¼Œæ‰€ä»¥å‡ºç°äº†é›†åˆ

------

æ•°ç»„å’Œé›†åˆçš„å·®åˆ«å¦‚ä¸‹

|                |                    é›†åˆ                    |            æ•°ç»„            |
| :------------: | :----------------------------------------: | :------------------------: |
|      é•¿åº¦      |             é•¿åº¦å¯å˜ï¼Œè‡ªåŠ¨æ‰©å®¹             |          é•¿åº¦å›ºå®š          |
| å…ƒç´ çš„æ•°æ®ç±»å‹ | åªèƒ½æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ä½¿ç”¨åŒ…è£…ç±» | åŸºæœ¬æ•°æ®ç±»å‹ã€å¼•ç”¨æ•°æ®ç±»å‹ |
|      å†…å®¹      |           å¯ä»¥å­˜çš„ä¸åŒç±»å‹çš„å…ƒç´            |       åŒä¸€ç±»å‹çš„å…ƒç´        |

## äºŒã€é›†åˆä½“ç³»ç»“æ„

é›†åˆåˆ†ä¸ºä¸¤ç±»ï¼Œå³å•åˆ—é›†åˆCollectionç³»åˆ—å’ŒåŒåˆ—é›†åˆMapç³»åˆ—ï¼ŒåŒåˆ—é€šè¿‡é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨

![1664635440488](assets/1664635440488.png)

![1664718162490](assets/1664718162490.png)

## ä¸‰ã€Collectioné›†åˆ

### 1.Collectionæ˜¯ä»€ä¹ˆï¼Ÿ

Collectionæ˜¯å•åˆ—é›†åˆçš„ç¥–å®—æ¥å£ï¼Œä»–çš„åŠŸèƒ½å¯è¢«å…¨éƒ¨çš„å•åˆ—é›†åˆç»§æ‰¿ä½¿ç”¨ï¼Œå…¶å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹

|                æ–¹æ³•                 |                             è¯´æ˜                             |
| :---------------------------------: | :----------------------------------------------------------: |
|      `boolean add(Object obj)`      |                     å°†æŒ‡å®šå¯¹è±¡æ·»åŠ åˆ°é›†åˆ                     |
|   `boolean addAll(Collection c)`    |       å°†å‚æ•°é›†åˆä¸­æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°è°ƒç”¨è¯¥æ–¹æ³•çš„é›†åˆå¯¹è±¡ä¸­       |
|           `void clear()`            |                      æ¸…ç©ºé›†åˆä¸­æ‰€æœ‰å…ƒç´                       |
|        `boolean remove(E e)`        |                    å°†ç»™å®šå¯¹è±¡åœ¨é›†åˆä¸­ç§»é™¤                    |
|  `boolean removeAll(Collection c)`  | å°†å‚æ•°é›†åˆä¸­éƒ¨åˆ†å…ƒç´ æˆ–æ‰€æœ‰å…ƒç´ ä»è°ƒç”¨è¯¥æ–¹æ³•çš„é›†åˆå¯¹è±¡ä¸­ç§»é™¤ï¼Œç§»é™¤ä¸€ä¸ªå…ƒç´ æˆåŠŸè¯¥æ–¹æ³•å°±è¿”å›`true` |
|    `boolean contains(Object o)`     |                åˆ¤æ–­å½“å‰é›†åˆä¸­æ˜¯å¦åŒ…å«ç»™å®šå¯¹è±¡                |
| `boolean containsAll(Collection c)` |  åˆ¤æ–­å½“å‰é›†åˆä¸­æ˜¯å¦åŒ…å«å‚æ•°é›†åˆä¸­çš„å…ƒç´ ï¼Œå…¨éƒ¨åŒ…å«è¿”å›`true`  |
|  `boolean retainAll(Collection c)`  | è·å–è°ƒç”¨é›†åˆå’Œå‚æ•°é›†åˆçš„äº¤é›†ä¿å­˜åˆ°è°ƒç”¨é›†åˆä¸­ï¼Œè¿”å›å€¼è¡¨ç¤ºçš„æ˜¯Aæ˜¯å¦å‘ç”Ÿè¿‡æ”¹å˜ |
|         `boolean isEmpty()`         |                     åˆ¤æ–­å½“å‰é›†åˆæ˜¯å¦ä¸ºç©º                     |
|            `int size()`             |                       è·å–é›†åˆå…ƒç´ ä¸ªæ•°                       |
|        `Object[] toArray()`         |                       å°†é›†åˆè½¬æ¢ä¸ºæ•°ç»„                       |
|      `Iterator<E> iterator()`       |    é›†åˆçš„ä¸“ç”¨çš„éå†æ–¹å¼ï¼Œè¿­ä»£å™¨ä¾èµ–é›†åˆè€Œå­˜åœ¨ï¼Œçœ‹æºç å¯çŸ¥    |

### 2.Collectionéå†æ–¹å¼

#### 2.1.è¿­ä»£å™¨éå†

è¿­ä»£å™¨åœ¨Javaä¸­ç›¸åº”çš„ç±»ä¸º`Iterator`ï¼Œä¾èµ–äºé›†åˆè€Œå­˜åœ¨ï¼Œæ˜¯é›†åˆçš„ä¸“ç”¨éå†æ–¹å¼ï¼Œè¿­ä»£å™¨éå†ä¸ä¾èµ–äºç´¢å¼•

Collectionè·å–è¿­ä»£å™¨çš„æ–¹æ³•æ˜¯`Iterator<E> iterator()`ï¼Œé»˜è®¤æŒ‡å‘å½“å‰é›†åˆçš„`0`ç´¢å¼•ï¼Œ`Iterator`çš„å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹

|        æ–¹æ³•         |                     è¯´æ˜                     |
| :-----------------: | :------------------------------------------: |
| `boolean hasNext()` |    åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦æœ‰å…ƒç´ ï¼Œæœ‰åˆ™è¿”å›`true`    |
|     `E next()`      | è·å–å½“å‰ä½ç½®çš„å…ƒç´ ï¼Œå¹¶å°†è¿­ä»£å™¨ç§»å‘ä¸‹ä¸€ä¸ªä½ç½® |

é›†åˆè¿­ä»£å™¨éå†çš„æ ¼å¼å¦‚ä¸‹

```java
Iterator<String> it = list.iterator();
while(it.hasNext()){
    String str = it.next();
    System.out.println(str);
}
```

å…³äºè¿­ä»£å™¨è¯·æ³¨æ„

* å½“æ²¡æœ‰å…ƒç´ è¿˜åœ¨ç»§ç»­`next()`æ—¶ï¼ŒæŠ¥é”™`NoSuchElementException`
* è¿­ä»£å™¨éå†å®Œæ¯•**æŒ‡é’ˆä¸ä¼šå¤ä½**ï¼Œè‹¥æƒ³è¦å†æ¬¡éå†åˆ™éœ€è¦å†æ¬¡åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡
* **è¿­ä»£å™¨éå†æ—¶ä¸èƒ½ä½¿ç”¨é›†åˆçš„æ–¹å¼å¢åŠ æˆ–åˆ é™¤å…ƒç´ **ï¼Œè‹¥æƒ³è¦åˆ é™¤å¯ä½¿ç”¨è¿­ä»£å™¨æä¾›çš„`remove()`ï¼Œè‹¥æƒ³è¦å¢åŠ å…ƒç´ æš‚æ—¶æ²¡åŠæ³•ï¼Œè‹¥å¼ºåˆ¶å¢åŠ æˆ–åˆ é™¤ä¼š**æŠ¥é”™`ConcurrentModificationException`å¹¶å‘ä¿®æ”¹å¼‚å¸¸**ï¼Œå› ä¸ºè¿­ä»£å™¨ä¾èµ–äºé›†åˆè€Œå­˜åœ¨ï¼Œé›†åˆæ·»åŠ æˆ–åˆ é™¤å…ƒç´ åè¿­ä»£å™¨å¹¶ä¸çŸ¥é“ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™

#### 2.2.å¢å¼ºforéå†

å¢å¼ºforåº•å±‚å°±æ˜¯è¿­ä»£å™¨ï¼Œä¸ºäº†ç®€åŒ–ä»£ç è€Œå‡ºç°ï¼Œåªæœ‰å•åˆ—é›†åˆå’Œæ•°ç»„æ‰å¯ä½¿ç”¨å¢å¼ºforæ¥éå†ï¼Œå¢å¼ºforæ ¼å¼å¦‚ä¸‹

```java
for(æ•°æ®ç±»å‹ å˜é‡å : æ•°ç»„æˆ–é›†åˆ){
    ...
}
```

çœ‹ä¸€ä¸ªå¢å¼ºforçš„å®ä¾‹

```java
for(String s : list){
    System.out.println(s);
}
```

`é›†åˆ.for`ç„¶åå›è½¦å¯ä»¥å¿«æ·ç”Ÿæˆå¢å¼ºfor

**è‹¥åœ¨å¢å¼ºforå¾ªç¯ä¸­ä¿®æ”¹å˜é‡ï¼Œä¸ä¼šæ”¹å˜åŸæœ¬çš„æ•°æ®**

#### 2.3.lambdaéå†

é€šè¿‡`default void forEach(Consumer<? super T> action)`å¯ä½¿ç”¨lambdaè¡¨è¾¾å¼éå†é›†åˆ

* åŸæ¥å†™æ³•

  ```java
  coll.forEach(new Consumer<String>(){
      @Override
      public void accept(String s){//æ­¤å¤„çš„så°±æ˜¯éå†åˆ°çš„æ¯ä¸€ä¸ªå…ƒç´ 
          System.out.println(s);
      }
  });
  ```

* lambdaè¡¨è¾¾å¼ç®€åŒ–ï¼Œå‰æConsumeræ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£

  ```java
  coll.forEach( s -> {
      System.out.println(s);
  });
  ```

------

### 3.Listé›†åˆ

#### 3.1.Listç‰¹ç‚¹

**æœ‰åº**ï¼šå­˜å’Œå–çš„é¡ºåºä¸€è‡´

**æœ‰ç´¢å¼•**ï¼šå¯é€šè¿‡ç´¢å¼•æ“ä½œå…ƒç´ 

**å¯é‡å¤**ï¼šå­˜å‚¨çš„å…ƒç´ å¯é‡å¤

#### 3.2.Listæ–¹æ³•

Collectionçš„æ–¹æ³•Listéƒ½ç»§æ‰¿äº†ï¼Œä½†Listé›†åˆæœ‰ç´¢å¼•çš„æ¦‚å¿µï¼Œæ‰€ä»¥Listé›†åˆæ–°å¢äº†å¾ˆå¤šç´¢å¼•ç›¸å…³çš„æ–¹æ³•ï¼Œå¦‚ä¸‹

|              æ–¹æ³•               |                 è¯´æ˜                 |
| :-----------------------------: | :----------------------------------: |
| `void add(int index,E element)` |      åœ¨é›†åˆæŒ‡å®šä½ç½®æ’å…¥æŒ‡å®šå…ƒç´       |
|      `E remove(int index)`      | åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œè¿”å›è¢«åˆ é™¤çš„å…ƒç´  |
|       `E get(int index)`        |          è¿”å›æŒ‡å®šä½ç½®çš„å…ƒç´           |
|  `E set(int index,E element)`   | ä¿®æ”¹æŒ‡å®šä½ç½®çš„å…ƒç´ ï¼Œè¿”å›è¢«ä¿®æ”¹çš„å…ƒç´  |
|  `ListIterator listIterator()`  |      åˆ—è¡¨è¿­ä»£å™¨ï¼Œä½¿ç”¨æ–¹å¼å‘ä¸‹çœ‹      |

è°ƒç”¨é‡è½½æ–¹å¼æ—¶ä¼šä¼˜å…ˆè°ƒç”¨å½¢å‚å’Œå®å‚ç±»å‹ç›¸åŒçš„æ–¹æ³•

```java
List<Integer> list = new ArrayList<String>();
list.add(1);
list.add(2);
list.add(3);

list.remove(1);//æ­¤å¤„çš„å‚æ•°å®é™…ä¸Šintå‹ï¼Œæ˜¯ç´¢å¼•å€¼ï¼Œåˆ é™¤çš„å®é™…ä¸Šæ˜¯2
```

#### 3.3.Listéå†æ–¹å¼

â‘ è¿­ä»£å™¨éå†ã€å¢å¼ºforéå†ã€lambdaéå†ä¸Collectionç›¸åŒ

â‘¡æ™®é€šforå¾ªç¯

```java
for(int i=0;i<list.size();i++){
    String s - list.get(i);
    System.out.println(s);
}
```

â‘¢åˆ—è¡¨è¿­ä»£å™¨éå†

ListIteratoræ˜¯Iteratorçš„å­æ¥å£ï¼ŒCollectionè·å–è¿­ä»£å™¨çš„æ–¹æ³•æ˜¯`ListIterator listIterator()`ï¼Œ`ListIterator`çš„å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹

|          æ–¹æ³•           |                     è¯´æ˜                     |
| :---------------------: | :------------------------------------------: |
|   `boolean hasNext()`   |    åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦æœ‰å…ƒç´ ï¼Œæœ‰åˆ™è¿”å›`true`    |
|       `E next()`        | è·å–å½“å‰ä½ç½®çš„å…ƒç´ ï¼Œå¹¶å°†è¿­ä»£å™¨ç§»å‘ä¸‹ä¸€ä¸ªä½ç½® |
| `boolean hasPrevious()` |        åˆ¤æ–­å½“å‰ä½ç½®æ˜¯å¦å­˜åœ¨å‰ä¸€ä¸ªå…ƒç´         |
|     `E previous()`      |            è·å–åˆ—è¡¨ä¸­çš„å‰ä¸€ä¸ªå…ƒç´             |
|     `void add(E e)`     | åœ¨è¿­ä»£å™¨éå†è¿‡ç¨‹ä¸­æ·»åŠ å…ƒç´ ï¼Œä¸æŠ¥å¹¶å‘ä¿®æ”¹å¼‚å¸¸ |
|     `void remove()`     | åœ¨è¿­ä»£å™¨éå†è¿‡ç¨‹ä¸­åˆ é™¤å…ƒç´ ï¼Œä¸æŠ¥å¹¶å‘ä¿®æ”¹å¼‚å¸¸ |

ListIteratorå¯ä»¥å®ç°é€†å‘éå†ï¼Œä½†æœ‰å±€é™ï¼Œåˆ—è¡¨è¿­ä»£å™¨è¢«åˆ›å»ºæ—¶ï¼ŒæŒ‡é’ˆé»˜è®¤æŒ‡å‘`0`ä½ç½®ï¼Œæ‰€ä»¥å¿…é¡»è¦å…ˆæ­£å‘éå†å°†ç´¢å¼•ç§»åŠ¨åˆ°æœ«å°¾æ‰èƒ½å®ç°é€†å‘éå†ï¼Œæ‰€ä»¥é€†å‘éå†ä¸€èˆ¬æ— æ„ä¹‰

åˆ—è¡¨è¿­ä»£å™¨éå†çš„æ ¼å¼å¦‚ä¸‹

```java
ListIterator<String> lit = list.listIterator();
while(lit.hasNext()){
    //åœ¨ä¾¿åˆ©çš„è¿‡ç¨‹ä¸­å¯ä½¿ç”¨è¿­ä»£å™¨çš„add()å’Œremove()å¢åŠ å’Œåˆ é™¤å…ƒç´ ï¼Œä¸æŠ¥å¹¶å‘ä¿®æ”¹å¼‚å¸¸
    String str = it.next();
    System.out.println(str);
}
```

### 4.Listæ•°æ®ç»“æ„

æˆ‘ä»¬çŸ¥é“Listå­˜åœ¨ä¸‰ç§ä¸åŒçš„å­ç±»ï¼Œé‚£ä¹ˆå®ƒä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸‰ä¸ªå­ç±»ï¼Ÿå­ç±»æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå…¶å®å­ç±»å­˜åœ¨æ•°æ®ç»“æ„ä¸Šçš„åŒºåˆ«ï¼Œä¸ºä¸åŒçš„ä¸šåŠ¡åœºæ™¯æé«˜æ•ˆç‡

æ•°æ®ç»“æ„å°±æ˜¯**è®¡ç®—æœºåº•å±‚å­˜å‚¨æ•°æ®ã€ç»„ç»‡æ•°æ®çš„æ–¹å¼**ï¼ŒæŒ‡æ•°æ®é—´ä»¥ä½•ç§æ–¹å¼æ’åˆ—åœ¨ä¸€èµ·ï¼Œæ•°æ®ç»“æ„ä¸ºäº†æ›´åŠ æ–¹ä¾¿çš„ç®¡ç†å’Œä½¿ç”¨æ•°æ®ï¼Œéœ€è¦ç»“åˆå…·ä½“çš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œé€‰æ‹©ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€‰æ‹©çš„æ•°æ®ç»“æ„éœ€è¦å¸¦æ¥æ›´é«˜çš„è¿è¡Œæˆ–å­˜å‚¨æ•ˆç‡

æ­¤å¤„å‘¢ä¸ä¼šè¿‡äºè¯¦ç»†çš„è®²è§£ï¼è¯·è§‚çœ‹[è§†é¢‘](https://www.bilibili.com/video/BV17F411T7Ao?p=189&vd_source=8811945bf338927db8b1ca45a8f75a87)å­¦ä¹ æ ˆã€é˜Ÿåˆ—ã€æ•°ç»„ã€é“¾è¡¨ç›¸å…³çŸ¥è¯†ï¼Œè¯·ä½ å¸¦ç€ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜å»å­¦ä¹ 

* è¯¥æ•°æ®ç»“æ„é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ
* å¦‚ä½•æ·»åŠ æ•°æ®ï¼Ÿ
* å¦‚ä½•åˆ é™¤æ•°æ®ï¼Ÿ

### 5.ArrayListé›†åˆ

#### 5.1.ArrayListç‰¹ç‚¹

**ArrayListçš„ç‰¹ç‚¹å¦‚ä¸‹**

* åº•å±‚ç»“æ„æ˜¯æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢
* çº¿ç¨‹ä¸å®‰å…¨ï¼Œä¸åŒæ­¥ï¼Œæ•ˆç‡é«˜
* åˆ›å»ºå¯¹è±¡æ—¶åˆ›å»ºé•¿åº¦ä¸º0çš„æ•°ç»„ï¼Œé¦–æ¬¡æ·»åŠ å…ƒç´ æ˜¯æ‰©å®¹é•¿åº¦ä¸º10çš„æ•°ç»„ï¼Œç„¶å1.5å€æ‰©å®¹ï¼Œè‹¥æ‰©å®¹åè¿˜æ˜¯è£…ä¸ä¸‹ï¼Œåˆ™æ–°æ•°ç»„é•¿åº¦ä¸ºå®é™…å…ƒç´ é•¿åº¦

åœ¨Collectionå’ŒListä¸­çš„å¸¸ç”¨æ–¹æ³•åœ¨ArrayListä¸­éƒ½å¯ä»¥ç›´æ¥æ‹¿è¿‡æ¥ç”¨ï¼Œæ‰€ä»¥ArrayListä¸­ä¸éœ€è¦å†å»å­¦ä¹ é¢å¤–çš„æ–¹æ³•

#### 5.2.ArrayListåº•å±‚åŸç†

**æ¥ä¸‹æ¥å­¦ä¹ å­¦ä¹ ArrayListçš„åº•å±‚åŸç†å§ï¼**

* **åœ¨åº•å±‚åˆ›å»ºé•¿åº¦ä¸º0çš„æ•°ç»„**

* **æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œåº•å±‚ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•¿åº¦ä¸º10çš„æ•°ç»„**

  ![1664686825055](assets/1664686825055.png)

* **éšç€ä¸æ–­åœ°æ·»åŠ ï¼Œå½“é•¿åº¦ä¸º10çš„æ•°æ®è¢«å¡«æ»¡æ—¶å°±éœ€è¦è‡ªåŠ¨æ‰©å®¹ï¼Œ1.5å€æ‰©å®¹åçš„æ–°æ•°ç»„é•¿åº¦ä¸º15ï¼Œè‹¥æ‰©å®¹åçš„é•¿åº¦è£…å¾—ä¸‹åˆ™1.5å€æ‰©å®¹ï¼Œè‹¥æ‰©å®¹åçš„é•¿åº¦è£…ä¸ä¸‹åˆ™æ–°æ•°ç»„é•¿åº¦ä¸ºå®é™…å…ƒç´ é•¿åº¦ï¼Œå°†åŸæ•°ç»„å†…çš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„åç»§ç»­æ·»åŠ å…ƒç´ **

æ¥å¼€å§‹å•ƒæºç ï¼

â‘ åˆ›å»ºé•¿åº¦ä¸º0çš„æ•°ç»„

```java
//æŒ‰ä½Ctrlï¼Œé¼ æ ‡ç‚¹å‡»ArrayList
ArrayList<String> a = new ArrayList<>();
```

```java
transient Object[] elementData;
private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};

public ArrayList() {
    this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
}
```

â‘¡æ‰©å®¹éƒ¨åˆ†ä¸»è¦å°±æ˜¯åœ¨`add(E e)`å†…ä½“ç°ï¼Œæ‰€ä»¥è¿›å…¥`add(E e)`

```java
private int size;//sizeæ˜¯elementDataæ•°ç»„çš„é•¿åº¦
public boolean add(E e) {
    //ensureCapacityInternal	*<1>*
    ensureCapacityInternal(size + 1);//æ­¤æ—¶å·²ç»æ‰©å®¹å®Œæ¯•
    elementData[size++] = e;
    return true;
}
```

```java
private static final int DEFAULT_CAPACITY = 10;

private void ensureCapacityInternal(int minCapacity) {
    //å½“å‰æ•°ç»„æ˜¯é•¿åº¦ä¸º0çš„æ•°ç»„æ—¶ï¼Œå³æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œåˆ›å»ºé•¿åº¦ä¸º10çš„æ•°ç»„
    if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) {
        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);
    }

    //ensureExplicitCapacity	*<2>*
    ensureExplicitCapacity(minCapacity);
}
```

```java
private void ensureExplicitCapacity(int minCapacity) {
    modCount++;

    //è‹¥æœ€å°å®¹é‡>å®é™…å®¹é‡ï¼Œåˆ™éœ€è¦è¿›å…¥growæ–¹æ³•çœŸæ­£æ‰©å®¹
    if (minCapacity - elementData.length > 0)
        //grow	*<3>*
        grow(minCapacity);
}
```

```java
private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;

private void grow(int minCapacity) {
    //å®é™…å®¹é‡
    int oldCapacity = elementData.length;//0
    //1.5å€æ‰©å®¹åçš„æ–°å®¹é‡
    int newCapacity = oldCapacity + (oldCapacity >> 1);//0
    if (newCapacity - minCapacity < 0)//
        newCapacity = minCapacity;
    if (newCapacity - MAX_ARRAY_SIZE > 0)
        //hugeCapacity	*<4>*
        newCapacity = hugeCapacity(minCapacity);
    
    //åº•å±‚ä½¿ç”¨System.arraycopy()
    elementData = Arrays.copyOf(elementData, newCapacity);
}
//grow()å®Œæ¯•ï¼Œè¯·å›åˆ°<1>ç»§ç»­å‘ä¸‹
```

```java
private static int hugeCapacity(int minCapacity) {
    if (minCapacity < 0) // overflow
        throw new OutOfMemoryError();
    return (minCapacity > MAX_ARRAY_SIZE) ?
        Integer.MAX_VALUE :
    MAX_ARRAY_SIZE;
}
```

### 6.LinkedListé›†åˆ

**LinkedListçš„ç‰¹ç‚¹å¦‚ä¸‹**

- åº•å±‚ç»“æ„æ˜¯åŒå‘é“¾è¡¨ï¼ŒæŸ¥è¯¢æ…¢ï¼Œå¢åˆ å¿«ï¼Œä½†å¦‚æœæ“ä½œçš„æ˜¯é¦–å°¾å…ƒç´ é‚£é€Ÿåº¦ä¹Ÿæ˜¯æå¿«çš„
- çº¿ç¨‹ä¸å®‰å…¨ï¼Œä¸åŒæ­¥ï¼Œæ•ˆç‡é«˜

LinkedListåº•å±‚æ˜¯é“¾è¡¨ï¼Œæ‰€ä»¥LinkedListä¸­éœ€è¦å†å»å­¦ä¹ é¢å¤–çš„æ–¹æ³•

|           æ–¹æ³•            |       è¯´æ˜       |
| :-----------------------: | :--------------: |
| `void addFirst(Object e)` | é“¾è¡¨å¼€å¤´æ’å…¥å…ƒç´  |
| `void addLast(Object e)`  | é“¾è¡¨ç»“å°¾æ’å…¥å…ƒç´  |
|      `E getFirst()`       | è·å–é“¾è¡¨å¼€å¤´å…ƒç´  |
|       `E getLast()`       | è·å–é“¾è¡¨ç»“å°¾å…ƒç´  |
|     `E removeFirst()`     | ç§»é™¤é“¾è¡¨å¼€å¤´å…ƒç´  |
|     `E removeLast()`      | ç§»é™¤é“¾è¡¨ç»“å°¾å…ƒç´  |

LinkedListçš„æ·»åŠ æ–¹æ³•åº•å±‚æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯é“¾è¡¨çš„å¢åˆ ï¼Œé“¾è¡¨ä¸å­˜åœ¨å®¹é‡çš„æ¦‚å¿µï¼Œæ‰€ä»¥**LinkedListä¸å­˜åœ¨è‡ªåŠ¨æ‰©å®¹æœºåˆ¶**

### 7.Vectoré›†åˆ

Vectorç”¨çš„å¾ˆå°‘ï¼Œå’±ä»¬å°±è®°ä½ä»–çš„ç‰¹ç‚¹

* åº•å±‚ç»“æ„æ˜¯æ•°ç»„ï¼ŒæŸ¥è¯¢å¿«ï¼Œå¢åˆ æ…¢
* çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ï¼Œæ•ˆç‡ä½
* 2å€æ‰©å®¹

------

### 8.Seté›†åˆ

**æ— åº**ï¼šå­˜å’Œå–çš„é¡ºåºä¸ä¸€è‡´ï¼Œè¿™é‡Œçš„æ— åºæ˜¯ç›¸å¯¹çš„ï¼ŒSeté›†åˆæœ¬èº«æœ‰è‡ªå·±çš„é¡ºåºï¼Œå¯èƒ½å­˜åœ¨å­˜å’Œå–çš„é¡ºåºä¸€è‡´çš„ç‰¹æ®Šæƒ…å†µ

**æ— ç´¢å¼•**ï¼šä¸å¯é€šè¿‡ç´¢å¼•æ“ä½œå…ƒç´ 

**ä¸å¯é‡å¤**ï¼šå­˜å‚¨çš„å…ƒç´ ä¸å¯é‡å¤

> Seté›†åˆæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£çš„æ–¹æ³•åŸºæœ¬ä¸Šå’ŒCollectionä¸€è‡´ï¼Œæ‰€ä»¥æ­¤å¤„ä¸è¿‡å¤šè®²è§£

### 9.Setæ•°æ®ç»“æ„

#### 9.1.ç®€å•æ•°æ®ç»“æ„

è¯·è§‚çœ‹[è§†é¢‘1](https://www.bilibili.com/video/BV17F411T7Ao?p=194&spm_id_from=pageDriver&vd_source=8811945bf338927db8b1ca45a8f75a87)ã€[è§†é¢‘2](https://www.bilibili.com/video/BV17F411T7Ao?p=195&vd_source=8811945bf338927db8b1ca45a8f75a87)ã€[è§†é¢‘3](https://www.bilibili.com/video/BV17F411T7Ao?p=196&vd_source=8811945bf338927db8b1ca45a8f75a87)å­¦ä¹ äºŒå‰æ ‘ã€äºŒå‰æŸ¥æ‰¾æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€çº¢é»‘æ ‘ç›¸å…³çŸ¥è¯†ï¼Œè¯·ä½ å¸¦ç€ä»¥ä¸‹ä¸‰ä¸ªé—®é¢˜å»å­¦ä¹ 

- è¯¥æ•°æ®ç»“æ„é•¿ä»€ä¹ˆæ ·å­ï¼Ÿ
- å¦‚ä½•æ·»åŠ æ•°æ®ï¼Ÿ
- å¦‚ä½•åˆ é™¤æ•°æ®ï¼Ÿ

------

æ­¤å¤„ç®€å•ä»‹ç»å‡ ç§æ•°æ®ç»“æ„çš„ç‰¹ç‚¹

* äºŒå‰æ ‘ï¼šä»»æ„èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°é‡éƒ½å°äºç­‰äº2ï¼Œä½†æ™®é€šäºŒå‰æ ‘çš„å…ƒç´ éƒ½æ˜¯éšæ„æ‘†æ”¾çš„ï¼ŒæŸ¥æ‰¾éå¸¸éº»çƒ¦
* äºŒå‰æŸ¥æ‰¾æ ‘ï¼šé¦–å…ˆæ˜¯ä¸€é¢—äºŒå‰æ ‘ï¼Œä»»æ„èŠ‚ç‚¹å­˜åœ¨è§„å¾‹`å·¦å­èŠ‚ç‚¹çš„å€¼ < å½“å‰èŠ‚ç‚¹çš„å€¼ < å³å­èŠ‚ç‚¹çš„å€¼`ï¼Œä½†å¯èƒ½å­˜åœ¨å·¦å­æ ‘ä¸å­˜åœ¨ï¼Œå…ƒç´ å…¨åœ¨å³å­æ ‘çš„æƒ…å†µï¼Œå¯¼è‡´å·¦å³å­æ ‘ä¸å¹³è¡¡ï¼ŒæŸ¥è¯¢æ•ˆç‡é™ä½
  * æ·»åŠ èŠ‚ç‚¹è§„åˆ™æ˜¯å°çš„å­˜å·¦è¾¹ï¼Œå¤§çš„å­˜å³è¾¹ï¼Œç›¸ç­‰çš„ä¸å­˜
  * æŸ¥æ‰¾èŠ‚ç‚¹è§„åˆ™æ˜¯å…ˆä¸æ ¹èŠ‚ç‚¹æ¯”å¤§å°ï¼Œå½“å‰èŠ‚ç‚¹å°å‘å·¦è¾¹æ‰¾ï¼Œå½“å‰èŠ‚ç‚¹å¤§å‘å³è¾¹æ‰¾ï¼Œç›¸ç­‰åˆ™æ‰¾åˆ°
  * éå†èŠ‚ç‚¹åˆ†ä¸ºå‰åºéå†ã€ä¸­åºéå†ã€ååºéå†ä»¥åŠå±‚åºéå†ï¼Œæ­¤å¤„ä¸è¯¦ç»†è®²è§£
* å¹³è¡¡äºŒå‰æ ‘ï¼šé¦–å…ˆæ˜¯ä¸€é¢—äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œè¦æ±‚ä»»æ„èŠ‚ç‚¹å·¦å³å­æ ‘é«˜åº¦å·®ä¸è¶…è¿‡1ï¼Œä¿è¯æŸ¥è¯¢æ•ˆç‡ï¼Œå¹³è¡¡äºŒå‰æ ‘å¦‚ä½•ä¿è¯å¹³è¡¡ï¼Ÿé€šè¿‡æ—‹è½¬æœºåˆ¶ï¼Œæ­¤å¤„ä¸è¯¦ç»†è®²è§£
* çº¢é»‘æ ‘ï¼šæ¯”è¾ƒé‡è¦ï¼Œè¯·å‘ä¸‹ç»§ç»­

#### 9.2.çº¢é»‘æ ‘

çº¢é»‘æ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œåˆç§°å¹³è¡¡äºŒå‰Bæ ‘ï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ç§**ç‰¹æ®Šçš„äºŒå‰æŸ¥æ‰¾æ ‘**ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰**å­˜å‚¨ä½è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„é¢œè‰²**ï¼Œæ¯ä¸ªé¢œè‰²å¯ä»¥æ˜¯**çº¢æˆ–é»‘**

çº¢é»‘æ ‘**ä¸æ˜¯é«˜åº¦å¹³è¡¡çš„**ï¼Œä»–çš„å¹³è¡¡é€šè¿‡**çº¢é»‘è§„åˆ™**è¿›è¡Œå®ç°ï¼Œæ³¨æ„çº¢é»‘æ ‘ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Œå› ä¸ºå¹³è¡¡äºŒå‰æ ‘ä¼šé€ æˆæ·»åŠ èŠ‚ç‚¹æ˜¯æ•ˆç‡è¿‡ä½ï¼Œ**å½“çº¢é»‘æ ‘ä¸æ»¡è¶³çº¢é»‘è§„åˆ™æ—¶ï¼Œæ‰ä¼šæ—‹è½¬**

![1664703998188](assets/1664703998188.png)

------

**çº¢é»‘è§„åˆ™å¦‚ä¸‹**

* **æ¯ä¸ªèŠ‚ç‚¹åªèƒ½æ˜¯çº¢è‰²æˆ–è€…é»‘è‰²**
* **æ ¹èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²**
* **æ²¡æœ‰å·¦å³å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œå³å¶å­èŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¸”å…¶æŒ‡é’ˆå±æ€§ä½Nil**
* **çº¢è‰²èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯é»‘è‰²ï¼Œå³ä¸èƒ½å‡ºç°ä¸¤ä¸ªçº¢è‰²èŠ‚ç‚¹ç›¸é‚»çš„æƒ…å†µ**
* **å¯¹ä»»æ„èŠ‚ç‚¹ï¼Œä»è¯¥èŠ‚ç‚¹åˆ°å…¶åä»£æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„ç®€å•è·¯å¾„ä¸Šå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²èŠ‚ç‚¹**
  * ç®€å•è·¯å¾„ï¼šä¸èµ°å›å¤´è·¯çš„è·¯å¾„

------

 çº¢é»‘æ ‘æ·»åŠ èŠ‚ç‚¹è§„åˆ™

* **æ·»åŠ çš„èŠ‚ç‚¹é»˜è®¤æ˜¯çº¢è‰²æ•ˆç‡æ›´é«˜**ï¼Œå¯¹äº`18`ã€`20`ã€`23`è¿™ä¸‰ä¸ªå…ƒç´ ï¼Œå°è¯•å°†å…¶å…¨éƒ¨çœ‹æˆé»‘è‰²æ·»åŠ èŠ‚ç‚¹ï¼Œä¸æ»¡è¶³è§„åˆ™æ—¶è°ƒæ•´ä¸¤æ¬¡ï¼Œå°è¯•å°†å…¶å…¨éƒ¨çœ‹æˆçº¢è‰²æ·»åŠ èŠ‚ç‚¹ï¼Œä¸æ»¡è¶³è§„åˆ™æ—¶åªéœ€è°ƒæ•´ä¸€æ¬¡

* é™¤äº†ä»¥ä¸Šçš„åŸºç¡€è§„åˆ™ï¼Œè¿˜å­˜åœ¨ä»¥ä¸‹ç»†åŒ–è§„åˆ™ï¼Œé€šè¿‡æ·»åŠ `20`ã€`18`ã€`23`ã€`22`ã€`17`ã€`24`ã€`19`èŠ‚ç‚¹å½¢æˆçº¢é»‘æ ‘æ¥ç»ƒä¹ è¿™äº›è§„åˆ™å§ï¼Œç­”æ¡ˆå°±åœ¨[è§†é¢‘23:10](https://www.bilibili.com/video/BV17F411T7Ao/?p=196&spm_id_from=pageDriver&vd_source=8811945bf338927db8b1ca45a8f75a87)ä¸­

  ![1664705636388](assets/1664705636388.png)

------

çº¢é»‘æ ‘çš„å¢åˆ æ”¹æŸ¥çš„æ€§èƒ½ç›¸å¯¹éƒ½æ˜¯è¾ƒå¥½çš„ï¼Œä½†æ˜¯ä»–çš„ä¿®æ”¹è§„åˆ™å¦‚æ­¤å¤æ‚ï¼Œæ•ˆç‡ä¸ºä»€ä¹ˆä¼šæ›´é«˜ï¼Ÿå…¶**å®çœŸæ­£å½±å“æ•ˆç‡çš„æ˜¯æ—‹è½¬ï¼Œè€Œçº¢é»‘æ ‘æ›´å¤šçš„åªæ˜¯åœ¨æ”¹å˜èŠ‚ç‚¹çš„é¢œè‰²**ï¼Œè™½ç„¶ä¹Ÿå­˜åœ¨æ—‹è½¬ï¼Œä½†æ¬¡æ•°æ¯”å¹³è¡¡äºŒå‰æ ‘å°‘å¾ˆå¤š

### 10.HashSeté›†åˆ

#### 10.1.HashSetç‰¹ç‚¹

HashSetçš„ç‰¹ç‚¹æ˜¯æ— åºã€ä¸é‡å¤ã€æ— ç´¢å¼•ï¼Œçº¿ç¨‹ä¸å®‰å…¨

åº•å±‚é‡‡å–**å“ˆå¸Œè¡¨**å®ç°å­˜å‚¨æ•°æ®ï¼Œå®é™…æ˜¯HashMapï¼Œå“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¢åˆ æ”¹æŸ¥æ•°æ®æ€§èƒ½éƒ½æ¯”è¾ƒå¥½çš„ç»“æ„

* JDK8ä»¥å‰å“ˆå¸Œè¡¨é€šè¿‡æ•°ç»„ã€é“¾è¡¨å®ç°
* JDK8å“ˆå¸Œè¡¨é€šè¿‡**æ•°ç»„ã€é“¾è¡¨ã€çº¢é»‘æ ‘**å®ç°

**å“ˆå¸Œå€¼**æ˜¯æ ¹æ®`hashCode()`è®¡ç®—å‡ºæ¥çš„`int`ç±»å‹çš„æ•´æ•°ï¼Œè¯¥æ–¹æ³•å±äºObjectï¼Œä¸€èˆ¬ä¼šé‡å†™

* è‹¥æœªé‡å†™åˆ™ä¸åŒå¯¹è±¡è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼ä¸åŒï¼Œå› ä¸ºåœ°å€å€¼ä¸åŒ
* è‹¥é‡å†™åˆ™å¯¹è±¡çš„å±æ€§å€¼ç›¸åŒåˆ™è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼ç›¸åŒ
* å°±ç®—ä¸åŒå¯¹è±¡æˆ–ä¸åŒå±æ€§è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œå€¼ä¹Ÿå¯èƒ½ç›¸åŒï¼Œå› ä¸ºå“ˆå¸Œå†²çª

å“ˆå¸Œå†²çªåªæ˜¯ä¸€ç§å¯èƒ½ï¼Œå¯èƒ½æ€§æå°ï¼Œå› ä¸º`int`çš„èŒƒå›´æ˜¯`[-21äº¿å¤š,21äº¿å¤š]`ï¼Œé‚£ä¹ˆæ­¤å¤„åˆ›å»º50äº¿å“¥å¯¹è±¡ï¼Œåˆ™è‡³å°‘æœ‰8äº¿ä¸ªå¯¹è±¡äº§ç”Ÿå“ˆå¸Œå†²çªï¼Œè¿™åªæ˜¯ä¸€ç§æç«¯çš„æƒ…å†µ

#### 10.2.JDK8ä»¥åHashSetçš„åº•å±‚åŸç†

HashSetçš„åº•å±‚åŸç†å¦‚ä¸‹

* **åˆ›å»ºé»˜è®¤é•¿åº¦ä¸º16ï¼Œé»˜è®¤åŠ è½½å› å­ä¸º0.75çš„æ•°ç»„**

  ![1664708299681](assets/1664708299681.png)

* **å½“ä½¿ç”¨`add()`æ·»åŠ æ•°æ®æ—¶ï¼Œé€šè¿‡`hashCode()`è®¡ç®—æ·»åŠ çš„å…ƒç´ çš„å“ˆå¸Œå€¼**

* **æ ¹æ®å“ˆå¸Œå€¼ä¸æ•°ç»„çš„é•¿åº¦è®¡ç®—å‡ºæ’å…¥ä½ç½®ï¼Œè®¡ç®—å…¬å¼æ˜¯`int index = (æ•°ç»„é•¿åº¦-1) & å“ˆå¸Œå€¼`ğŸ‘€**

* **åˆ¤æ–­æ’å…¥ç‚¹ä½ç½®æ˜¯å¦ä¸º`null`ï¼Œè‹¥æ˜¯åˆ™ç›´æ¥å­˜å…¥**

  ![1664709857220](assets/1664709857220.png)

* **åˆ¤æ–­æ’å…¥ç‚¹ä½ç½®æ˜¯å¦ä¸º`null`ï¼Œè‹¥ä¸æ˜¯åˆ™è°ƒç”¨`equals()`åˆ¤æ–­å¯¹è±¡çš„å±æ€§æ˜¯å¦ç›¸åŒï¼Œè‹¥ç›¸åŒåˆ™ä¸èƒ½åŠ å…¥ï¼Œè‹¥ä¸åŒåˆ™æŒ‰å“ˆå¸Œå†²çªå¤„ç†åŠæ³•å¤„ç†**

  * JDK8ä»¥å‰æ–°å…ƒç´ å­˜å…¥æ•°ç»„ï¼Œè€å…ƒç´ æŒ‚åœ¨æ–°å…ƒç´ ä¸Šé¢

    ![1664710175791](assets/1664710175791.png)

  * JDK8æ–°å…ƒç´ ç›´æ¥æŒ‚åœ¨è€å…ƒç´ åé¢

    ![1664710212698](assets/1664710212698.png)

* **éšç€æ•°ç»„å†…å…ƒç´ è¶Šæ¥è¶Šå¤šï¼Œæ­¤æ—¶å°±ä¸åŠ è½½å› å­æœ‰å…³äº†ï¼Œå½“æ•°ç»„å­˜äº†`æ•°ç»„é•¿åº¦ * åŠ è½½å› å­`ä¸ªå…ƒç´ æ—¶ï¼Œæ•°ç»„å°±ä¼š2å€æ‰©å®¹**

* **å½“æ•°ç»„é•¿åº¦å¤§äºç­‰äº64ä¸”é“¾è¡¨é•¿åº¦å¤§äº8ï¼Œé“¾è¡¨å°±ä¼šè½¬æˆçº¢é»‘æ ‘**

  ![1664710544992](assets/1664710544992.png)

#### 10.3.HashSetä¸‰é—®é¢˜

â‘ HashSetä¸ºä»€ä¹ˆå­˜å’Œå–çš„é¡ºåºä¸ä¸€è‡´ï¼Ÿ

éå†HashSetå…ƒç´ æ—¶ï¼Œæ ¹æ®æ•°ç»„çš„ç´¢å¼•é¡ºåºï¼Œä¸€æ¡é“¾è¡¨ä¸€æ¡é“¾è¡¨çš„éå†ï¼Œå³æ•°ç»„å…ƒç´ [0]çš„é“¾è¡¨éå†åï¼Œå†éå†æ•°ç»„ç´¢å¼•[1]ä¸­çš„é“¾è¡¨ï¼Œæ‰€ä»¥å­˜å’Œå–çš„é¡ºåºå½“ç„¶ä¸ä¸€è‡´

â‘¡HashSetä¸ºä»€ä¹ˆæ²¡æœ‰ç´¢å¼•ï¼Ÿ

æ•°ç»„å†…å­˜çš„æ˜¯é“¾è¡¨ï¼Œè‹¥å­˜åœ¨ç´¢å¼•æœºåˆ¶ï¼Œé‚£ä¹ˆåŒä¸€é“¾è¡¨ä¸Šçš„æ‰€æœ‰å…ƒç´ ç´¢å¼•éƒ½ç›¸åŒï¼Ÿè¿™æ˜¾ç„¶ä¸å¥½ï¼Œæ‰€ä»¥å¹²è„†å–æ¶ˆäº†ç´¢å¼•æœºåˆ¶

â‘¢HashSetåˆ©ç”¨ä»€ä¹ˆæœºåˆ¶ä¿è¯æ•°æ®å»é‡ï¼Ÿ

å…¶å®å°±æ˜¯åˆ©ç”¨`hashCode`å’Œ`equals`ï¼Œè‹¥HashSetä¸­å­˜çš„æ˜¯è‡ªå®šä¹‰å¯¹è±¡ï¼Œä¸€å®šè¦é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•

#### 10.4.hashCodeå’Œequalså¦‚ä½•é‡å†™

![1664713200112](assets/1664713200112.png)

### 11.LinkedHashSeté›†åˆ

ä¸éœ€è¦å­¦ä¹ æ–°å¢çš„æ–¹æ³•ï¼Œåªéœ€è¦å­¦ä¹ å…¶åº•å±‚çš„åŸç†å³å¯ï¼Œå…¶ç‰¹ç‚¹ä¸º**æœ‰åº**ã€ä¸é‡å¤ã€æ— ç´¢å¼•ï¼Œå…¶ä¸­ä¸é‡å¤ã€æ— ç´¢å¼•çš„åŸå› å’Œä»–çˆ¹ä¸€æ ·ï¼Œé‚£ä¹ˆæœ‰åºå¦‚ä½•ç†è§£å‘¢ï¼Ÿå®é™…ä¸Šåº•å±‚ä¹Ÿæ˜¯å“ˆå¸Œè¡¨ï¼Œ**åªæ˜¯åœ¨å“ˆå¸Œè¡¨çš„åŸºç¡€ä¸Šåˆæ–°å¢äº†åŒé“¾è¡¨æœºåˆ¶è®°å½•å­˜å‚¨çš„é¡ºåº**ï¼Œåœ¨éå†æ—¶å®é™…ä¸Šéå†çš„æ˜¯åŒå‘é“¾è¡¨

![1664713570299](assets/1664713570299.png)

å½“éœ€æ±‚æ˜¯æ—¢è¦å»é‡ï¼Œåˆè¦æœ‰åºæ—¶æ‰ä½¿ç”¨LinkedHashSetï¼Œå¦åˆ™åªå»é‡çš„è¯è¿˜æ˜¯ä½¿ç”¨HashSet

### 12.TreeSeté›†åˆ

TreeSetçš„ç‰¹ç‚¹æ˜¯**å¯æ’åº**ã€ä¸é‡å¤ã€æ— ç´¢å¼•ï¼Œæ’åºè§„åˆ™å¦‚ä¸‹

* å¯¹äºåŒ…è£…ç±»ï¼Œé»˜è®¤ä»å°åˆ°å¤§æ’åº
* å¯¹äºå­—ç¬¦ä¸²ï¼Œé»˜è®¤ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹æ¯”è¾ƒASCIIè¡¨ç›¸åº”çš„å€¼
* å¯¹äºè‡ªå®šä¹‰çš„ç±»ï¼Œéœ€è¦å®ç°Comparableæ¥å£ï¼Œé‡å†™`compareTo()`å®ç°æ’åºè§„åˆ™

TreeSetåº•å±‚åŸºäº**çº¢é»‘æ ‘**å®ç°æ’åºï¼Œå¢åˆ æ”¹æŸ¥æ€§èƒ½éƒ½æ¯”è¾ƒå¥½ï¼Œç°åœ¨è°ˆä¸€è°ˆæ·»åŠ å…ƒç´ æ—¶åº•å±‚åœ¨å¹²å˜›ï¼Ÿ**æ·»åŠ å…ƒç´ æ—¶æŒ‰ç…§çº¢é»‘æ ‘çš„çº¢é»‘è§„åˆ™æ·»åŠ **ï¼Œä½†çº¢é»‘æ ‘æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œéœ€è¦æ¯”è¾ƒå¤§å°æ‰èƒ½æ·»åŠ å…ƒç´ ï¼Œæ¯”è¾ƒè§„åˆ™å¦‚ä¸Šï¼Œ**å¯¹äºè‡ªå®šä¹‰å¯¹è±¡ï¼Œæ¯”è¾ƒè§„å®šè¢«å®šä¹‰äº`compareTo()`å†…**ï¼Œå…·ä½“æ¡ˆä¾‹è¯·è§‚çœ‹[è§†é¢‘21:57](https://www.bilibili.com/video/BV17F411T7Ao/?p=198&spm_id_from=pageDriver&vd_source=8811945bf338927db8b1ca45a8f75a87)

------

Comparableå’ŒComparatorçš„åŒºåˆ«è¯·çœ‹[å¸¸ç”¨API](/Java/1.JavaåŸºç¡€/å¸¸ç”¨API)çš„[åã€Arrays]ï¼Œæ­¤å¤„ç›´æ¥è´´å‡ºä¸¤ä¸ªæ¡ˆä¾‹

```java
TreeSet<Student> ts = new TreeSet<Student>();

public class Student implements Comparable<Student> {
    @Override
    public int compareTo(Student s) {
        // æ ¹æ®è‡ªå®šä¹‰æ’åºè§„åˆ™
        // ä¸»è¦æ¡ä»¶
        int num = this.age - s.age;
        // æ¬¡è¦æ¡ä»¶  num=0è¡¨ç¤ºå¹´é¾„ç›¸åŒ
        int num2 = num == 0 ? this.name.compareTo(s.name) : num;
        return num2;
    }
}
```

```java
TreeSet<Student> ts = new TreeSet<Student>(new MyComparator());

public class MyComparator implements Comparator<Student> {
    @Override
    public int compare(Student s1, Student s2) {
        // æ ¹æ®è‡ªå®šä¹‰æ’åºè§„åˆ™this -- s1     s -- s2
        // ä¸»è¦æ¡ä»¶
        int num = s1.getAge() - s2.getAge();
        // æ¬¡è¦æ¡ä»¶  num=0è¡¨ç¤ºå¹´é¾„ç›¸åŒ
        int num2 = num == 0 ? s1.getName().compareTo(s2.getName()) : num;
        return num2;
    }
}
```

## å››ã€Mapé›†åˆ

### 1.Mapæ˜¯ä»€ä¹ˆï¼Ÿ

Mapä»¥é”®å€¼å¯¹(Entryå¯¹è±¡)çš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œå…¶ä¸­**é”®ä¸å¯é‡å¤ï¼Œå€¼å¯é‡å¤**ï¼Œé”®å€¼å¯¹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæ¯ä¸€ä¸ªé”®åªèƒ½æ‰¾åˆ°è‡ªå·±çš„å€¼

Mapæ˜¯åŒåˆ—é›†åˆçš„ç¥–å®—æ¥å£ï¼Œä»–çš„åŠŸèƒ½å¯è¢«å…¨éƒ¨çš„åŒåˆ—é›†åˆç»§æ‰¿ä½¿ç”¨ï¼Œå…¶å¸¸ç”¨æ–¹æ³•å¦‚ä¸‹

|                 æ–¹æ³•                  |                             è¯´æ˜                             |
| :-----------------------------------: | :----------------------------------------------------------: |
|        `V put(K key,V value)`         | æ·»åŠ å…ƒç´ ï¼Œè‹¥ç¬¬ä¸€æ¬¡æ·»åŠ åˆ™ç›´æ¥å­˜è¿”å›nullï¼Œè‹¥é”®å­˜åœ¨åˆ™å°†å€¼æ›¿æ¢ï¼Œå¹¶å°†æ›¿æ¢æ‰çš„å€¼è¿”å› |
|        `V remove(Object key)`         |                     æ ¹æ®é”®åˆ é™¤é”®å€¼å¯¹å…ƒç´                      |
|            `void clear()`             |                      ç§»é™¤æ‰€æœ‰é”®å€¼å¯¹å…ƒç´                       |
|   `boolean containsKey(Object key)`   |                   åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šçš„é”®                   |
| `boolean containsValue(Object value)` |                   åˆ¤æ–­é›†åˆæ˜¯å¦åŒ…å«æŒ‡å®šçš„å€¼                   |
|          `boolean isEmpty()`          |                       åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º                       |
|             `int size()`              |                é›†åˆçš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯é”®å€¼å¯¹çš„ä¸ªæ•°                |

### 2.Mapéå†æ–¹å¼

#### 2.1.é”®æ‰¾å€¼éå†

```java
//1.è·å–æ‰€æœ‰é”®
Set<String> set = map.keySet();
//2.éå†é”®çš„é›†åˆï¼Œåˆ†åˆ«å¾—åˆ°æ¯ä¸€ä¸ªé”®
for(String key : set){
    //3.é€šè¿‡é”®è·å–å€¼
    String value = map.get(key);
    System.out.println(key+":"+value);
}
```

#### 2.2.é”®å€¼å¯¹éå†

```java
//1.è·å–é”®å€¼å¯¹å¯¹è±¡é›†åˆ
Set<Map.Entry<String,String>> set = map.entrySet();
//2.éå†é”®å€¼å¯¹å¯¹è±¡é›†åˆï¼Œåˆ†åˆ«å¾—åˆ°æ¯ä¸€ä¸ªé”®å€¼å¯¹
for(Map.Entry<String,String> me : set){
    //3.æ ¹æ®é”®å€¼å¯¹å¯¹è±¡è·å–ç›¸åº”çš„é”®å’Œå€¼
    String key = me.getKey();
    String value = me.getValue();
    System.out.println(key+":"+value);
}
```

#### 2.3.lambdaéå†

é€šè¿‡`default void forEach(BiConsumer<? super K, ? super V> action)`å¯ä½¿ç”¨lambdaè¡¨è¾¾å¼éå†é›†åˆ

- åŸæ¥å†™æ³•

  ```java
  map.forEach(new BiConsumer<String,String>(){
      @Override
      public void accept(String key,String value){
          System.out.println(key+":"+value);
      }
  });
  ```

- lambdaè¡¨è¾¾å¼ç®€åŒ–ï¼Œå‰æConsumeræ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£

  ```java
  map.forEach( (key,value) -> {
      System.out.println(key+":"+value);
  });
  ```

### 3.HashMapé›†åˆ

#### 3.1.HashMapç‰¹ç‚¹

HashMapæ˜¯Mapçš„ä¸€ä¸ªå®ç°ç±»ï¼Œæ²¡æœ‰é¢å¤–çš„æ–¹æ³•éœ€è¦å­¦ä¹ 

HashMapç‰¹ç‚¹éƒ½ç”±é”®å†³å®šï¼Œå³**æ— åºã€ä¸é‡å¤ã€æ— ç´¢å¼•ã€çº¿ç¨‹ä¸å®‰å…¨ã€æ•ˆç‡é«˜**

HashSetçš„åº•å±‚å®é™…å°±æ˜¯HashMapï¼Œçœ‹æºç å¯çŸ¥ï¼Œæ‰€ä»¥HashMapä¹Ÿæ˜¯é€šè¿‡å“ˆå¸Œè¡¨ç»“æ„å®ç°ï¼Œå³**æ•°ç»„ã€é“¾è¡¨ã€çº¢é»‘æ ‘**

#### 3.2.HashMapåº•å±‚åŸç†

- **åˆ›å»ºé»˜è®¤é•¿åº¦ä¸º16ï¼Œé»˜è®¤åŠ è½½å› å­ä¸º0.75çš„æ•°ç»„**

  ![1664708299681](assets/1664708299681.png)

- **å½“ä½¿ç”¨`put()`æ·»åŠ æ•°æ®æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºEntryå¯¹è±¡ï¼ŒEntryå¯¹è±¡ä¸­å­˜é”®å’Œå€¼ï¼Œé€šè¿‡`hashCode()`è®¡ç®—æ·»åŠ çš„å…ƒç´ é”®çš„å“ˆå¸Œå€¼ï¼Œä¸æ·»åŠ å…ƒç´ çš„å€¼æ— å…³**

- **æ ¹æ®å“ˆå¸Œå€¼ä¸æ•°ç»„çš„é•¿åº¦è®¡ç®—å‡ºæ’å…¥ä½ç½®ï¼Œè®¡ç®—å…¬å¼æ˜¯`int index = (æ•°ç»„é•¿åº¦-1) & å“ˆå¸Œå€¼`ğŸ‘€**

- **åˆ¤æ–­æ’å…¥ç‚¹ä½ç½®æ˜¯å¦ä¸º`null`ï¼Œè‹¥æ˜¯åˆ™ç›´æ¥å­˜å…¥Entryå¯¹è±¡**

  ![1664718994054](assets/1664718994054.png)

- **åˆ¤æ–­æ’å…¥ç‚¹ä½ç½®æ˜¯å¦ä¸º`null`ï¼Œè‹¥ä¸æ˜¯åˆ™è°ƒç”¨`equals()`åˆ¤æ–­é”®çš„å±æ€§æ˜¯å¦ç›¸åŒï¼Œè‹¥ç›¸åŒåˆ™è¦†ç›–åŸæœ‰çš„Entryå¯¹è±¡ï¼Œè‹¥ä¸åŒåˆ™æŒ‰å“ˆå¸Œå†²çªå¤„ç†åŠæ³•å¤„ç†ï¼Œä¸HashSetå¤„ç†ç›¸åŒï¼Œåˆ†ä¸ºJDK8å‰å**

  ![1664719128004](assets/1664719128004.png)

- **éšç€æ•°ç»„å†…å…ƒç´ è¶Šæ¥è¶Šå¤šï¼Œæ­¤æ—¶å°±ä¸åŠ è½½å› å­æœ‰å…³äº†ï¼Œå½“æ•°ç»„å­˜äº†`æ•°ç»„é•¿åº¦ * åŠ è½½å› å­`ä¸ªå…ƒç´ æ—¶ï¼Œæ•°ç»„å°±ä¼š2å€æ‰©å®¹**

- **å½“æ•°ç»„é•¿åº¦å¤§äºç­‰äº64ä¸”é“¾è¡¨é•¿åº¦å¤§äº8ï¼Œé“¾è¡¨å°±ä¼šè½¬æˆçº¢é»‘æ ‘**

  ![1664710544992](assets/1664710544992.png)

> ä¾èµ–`hashCode()`å’Œ`equals()`ä¿è¯é”®çš„å”¯ä¸€æ€§

#### 3.3.HashMapæºç åˆ†æ

HashMapæºç åˆ†ææ˜¯ä¸€ä¸ªå¤§å·¥ç¨‹å•Šï¼ä¸‹é¢æˆ‘ä»¬ä»æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæ·»åŠ å…¶ä»–å…ƒç´ çš„å±‚é¢è¿›è¡Œåˆ†æï¼Œæ¢ç©¶HashMapåº•å±‚ã€‚æ·»åŠ å…ƒç´ æ—¶è‡³å°‘è€ƒè™‘å¦‚ä¸‹ä¸‰ç§æƒ…å†µ

* å…ƒç´ ä½ç½®ä¸º`null`ï¼Œåˆ™ç›´æ¥æ·»åŠ 
* å…ƒç´ ä½ç½®ä¸ä¸º`null`ï¼Œé”®é‡å¤ï¼Œåˆ™å…ƒç´ è¦†ç›–
* å…ƒç´ ä½ç½®ä¸ä¸º`null`ï¼Œé”®ä¸é‡å¤ï¼Œåˆ™æŒ‚æ¥åœ¨é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸‹

æºç åˆ†ææˆ‘ä»¬ä¹Ÿå°†é€šè¿‡ä»¥ä¸‹ä»£ç è¿›è¡Œè¿½è¸ª

```java
HashMap<String,String> map = new HashMap<>();
map.put("aaa",111);
map.put("bbb",222);
map.put("ccc",333);
map.put("ddd",444);
map.put("ddd",555);
```

------

â‘ åˆ›å»ºHashMapå¯¹è±¡

* åˆå§‹åŒ–é»˜è®¤åŠ è½½å› å­ä¸º0.75

```java
//æŒ‰ä½Ctrlï¼Œé¼ æ ‡ç‚¹å‡»HashMap
HashMap<String,String> map = new HashMap<>();
```

```java
final float loadFactor;
static final float DEFAULT_LOAD_FACTOR = 0.75f;

public HashMap() {
    this.loadFactor = DEFAULT_LOAD_FACTOR; //åŠ è½½å› å­
}
```

------

â‘¡å‘HashMapæ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ `map.put("aaa",111);`

* æ‰©å®¹éƒ¨åˆ†ä¸»è¦å°±æ˜¯åœ¨`put`å†…ä½“ç°ï¼Œè¿›å…¥`put()`

```java
public V put(K key, V value) {
    //hash(key)	*<1>*	è·å–é”®çš„å“ˆå¸Œå€¼å¹¶åšä¸€äº›å¤„ç†
    //putVal(é”®å“ˆå¸Œå€¼,é”®,å€¼,è‹¥é”®ç›¸åŒfalseåˆ™ä¼šè¦†ç›–åŸæ¥çš„,å…ˆä¸ç®¡)	*<2>*
    return putVal(hash(key), key, value, false, true);
}
```

```java
static final int hash(Object key) {
    int h;
    return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);//å“ˆå¸Œç®—æ³•
}
//hash()å®Œæ¯•ï¼Œè¯·å›åˆ°<1>ç»§ç»­å‘ä¸‹
```

```java
//Nodeå°±æ˜¯æ•°ç»„å†…é“¾è¡¨éƒ¨åˆ†
static class Node<K,V> implements Map.Entry<K,V> {
    final int hash;	//é”®çš„å“ˆå¸Œå€¼
    final K key;	//é”®
    V value;	//å€¼
    Node<K,V> next;	//ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
}
transient Node<K,V>[] table;//ä¿å­˜Entryå¯¹è±¡çš„æ•°ç»„
transient int size;//å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°
int threshold;//å“ˆå¸Œè¡¨çš„æ‰©å®¹æ—¶æœºï¼Œå€¼å°±æ˜¯æ•°ç»„é•¿åº¦*0.75ï¼Œèµ‹å€¼åœ¨resize()ä¸­å®Œæˆ

final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
    //Nodeç»“æ„å¦‚ä¸Šï¼ŒNodeå°±æ˜¯æ•°ç»„å†…é“¾è¡¨éƒ¨åˆ†
    Node<K,V>[] tab;//å®šä¹‰å±€éƒ¨å˜é‡ç”¨æ¥è®°å½•å“ˆå¸Œè¡¨ä¸­æ•°ç»„çš„åœ°å€å€¼
    //æ­¤å¤„æœ‰tableä¸ºä»€ä¹ˆè¿˜éœ€è¦å®šä¹‰å±€éƒ¨å˜é‡ï¼Ÿtableæ˜¯æˆå‘˜å˜é‡ï¼Œå®šä¹‰åœ¨å †ä¸­ï¼Œè€Œå±€éƒ¨å˜é‡å®šä¹‰åœ¨æ ˆä¸­ï¼Œè‹¥tableè¢«é¢‘ç¹ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±è¦é¢‘ç¹å»å †ä¸­æ‰¾ï¼Œç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ï¼Œæ•ˆç‡æ›´é«˜
    
    Node<K,V> p;//ä¸´æ—¶å˜é‡
    int n, i;//nè¡¨ç¤ºæ•°ç»„é•¿åº¦ï¼Œiè¡¨ç¤ºç´¢å¼•
    
    //å°†tableèµ‹å€¼ç»™tabï¼Œå“ˆå¸Œè¡¨æ•°ç»„é•¿åº¦èµ‹å€¼ç»™n
    //è‹¥å“ˆå¸Œè¡¨æ•°ç»„ä¸ºç©º æˆ– å“ˆå¸Œè¡¨æ•°ç»„é•¿åº¦ä¸º0ï¼Œåˆ™åˆå§‹åŒ–æ•°ç»„æˆ–æ‰©å®¹	==æ­¤æ—¶ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ tab=nullï¼Œè¿›å…¥if
    if ((tab = table) == null || (n = tab.length) == 0)
        //resize()æ­¤æ–¹æ³•å†…å®ç°äº†å…³é”®çš„æ‰©å®¹ï¼Œå°±ä¸å»çœ‹äº†ï¼Œæºç è¿˜æ˜¯åœ¨ä¸‹æ–¹è´´å‡º
        //	1.è‹¥æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ æ•°æ®åˆ™åˆ›å»ºé•¿åº¦ä¸º16ï¼ŒåŠ è½½å› å­ä¸º0.75çš„æ•°ç»„
        //	2.è‹¥ä¸æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ æ•°ç»„ä¸”æœªè¾¾åˆ°æ‰©å®¹æ¡ä»¶ï¼Œåˆ™åº•å±‚ä»€ä¹ˆä¹Ÿä¸å¹²
        //	3.è‹¥ä¸æ˜¯ç¬¬ä¸€æ¬¡æ·»åŠ æ•°ç»„ä¸”è¾¾åˆ°æ‰©å®¹æ¡ä»¶ï¼Œåˆ™åº•å±‚ä¸¤å€æ‰©å®¹ï¼Œå¹¶å°†åŸæ¥å“ˆå¸Œè¡¨ä¸­çš„æ‰€æœ‰æ•°æ®å…¨éƒ¨è½¬ç§»
        //å°†æ‰©å®¹åçš„æ•°ç»„çš„é•¿åº¦èµ‹å€¼ç»™n	==ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ ä¼šå°†æ•°ç»„æ‰©å®¹ä¸º16ï¼Œæ‰€ä»¥æ­¤æ—¶n=16
        n = (tab = resize()).length;
    
    //å°†å½“å‰å…ƒç´ çš„æ’å…¥ç´¢å¼•èµ‹å€¼ç»™iï¼Œå½“å‰å…ƒç´ èµ‹å€¼ç»™pï¼Œå½“å‰å…ƒç´ çš„æ’å…¥ä½ç½®è®¡ç®—è§„åˆ™ä¸º(n - 1) & hash
    //è‹¥å½“å‰å…ƒç´ éœ€è¦æ’å…¥çš„ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥	==ç¬¬ä¸€æ¬¡æ·»åŠ å…ƒç´ æ—¶è‚¯å®šæ˜¯nullï¼Œæ‰€ä»¥è¿›å…¥ifï¼Œelseä¸ä¼šè¢«æ‰§è¡Œ
    if ((p = tab[i = (n - 1) & hash]) == null)
        //newNodeè¿™ä¸ªæ–¹æ³•çš„åå­—å°±æœ‰ç‚¹æ•…åæ€æ„äº†ï¼å…¶å®å°±æ˜¯åˆ›å»ºNodeèŠ‚ç‚¹ï¼Œç„¶åå°†è¯¥NodeèŠ‚ç‚¹æ·»åŠ åˆ°æ•°ç»„	*<3>*
        tab[i] = newNode(hash, key, value, null);
    else {
        //å½“å‰å…ƒç´ éœ€è¦æ’å…¥çš„ä½ç½®ä¸ä¸ºç©º
        
        //æ·»åŠ å…¶ä»–å…ƒç´ æ—¶è®²è§£
    }
    ++modCount;//å…ˆä¸ç®¡
    
    //è‹¥å®é™…å…ƒç´ ä¸ªæ•°å¤§äºæ‰©å®¹æ—¶æœºï¼Œåˆ™éœ€è¦æ‰©å®¹	==æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶size=0ï¼Œ++size=1ï¼Œä¸ä¼šè¿›å…¥if
    if (++size > threshold)
        resize();
    
    //ä¸LinkedHashMapç›¸å…³ï¼Œå…ˆä¸ç®¡
    afterNodeInsertion(evict);
    
    //å½“å‰æ²¡æœ‰è¦†ç›–ä»»ä½•å…ƒç´ ï¼Œè¿”å›null
    return null;
}
//æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ çš„putVal()å®Œæ¯•ï¼Œè¯·çœ‹æœ€åçš„å°ç»“éƒ¨åˆ†
```

```java
static final int DEFAULT_INITIAL_CAPACITY = 1 << 4; //16

final Node<K,V>[] resize() {
    Node<K,V>[] oldTab = table;
    int oldCap = (oldTab == null) ? 0 : oldTab.length;
    int oldThr = threshold;
    int newCap, newThr = 0;
    if (oldCap > 0) {
        if (oldCap >= MAXIMUM_CAPACITY) {
            threshold = Integer.MAX_VALUE;
            return oldTab;
        }
        else if ((newCap = oldCap << 1) < MAXIMUM_CAPACITY &&
                 oldCap >= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr << 1; // double threshold
    }
    else if (oldThr > 0) // initial capacity was placed in threshold
        newCap = oldThr;
    else {               // zero initial threshold signifies using defaults
        newCap = DEFAULT_INITIAL_CAPACITY;
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    }
    if (newThr == 0) {
        float ft = (float)newCap * loadFactor;
        newThr = (newCap < MAXIMUM_CAPACITY && ft < (float)MAXIMUM_CAPACITY ?
                  (int)ft : Integer.MAX_VALUE);
    }
    threshold = newThr;
    @SuppressWarnings({"rawtypes","unchecked"})
    Node<K,V>[] newTab = (Node<K,V>[])new Node[newCap];
    table = newTab;
    if (oldTab != null) {
        for (int j = 0; j < oldCap; ++j) {
            Node<K,V> e;
            if ((e = oldTab[j]) != null) {
                oldTab[j] = null;
                if (e.next == null)
                    newTab[e.hash & (newCap - 1)] = e;
                else if (e instanceof TreeNode)
                    ((TreeNode<K,V>)e).split(this, newTab, j, oldCap);
                else { // preserve order
                    Node<K,V> loHead = null, loTail = null;
                    Node<K,V> hiHead = null, hiTail = null;
                    Node<K,V> next;
                    do {
                        next = e.next;
                        if ((e.hash & oldCap) == 0) {
                            if (loTail == null)
                                loHead = e;
                            else
                                loTail.next = e;
                            loTail = e;
                        }
                        else {
                            if (hiTail == null)
                                hiHead = e;
                            else
                                hiTail.next = e;
                            hiTail = e;
                        }
                    } while ((e = next) != null);
                    if (loTail != null) {
                        loTail.next = null;
                        newTab[j] = loHead;
                    }
                    if (hiTail != null) {
                        hiTail.next = null;
                        newTab[j + oldCap] = hiHead;
                    }
                }
            }
        }
    }
    return newTab;
}
```

```java
Node<K,V> newNode(int hash, K key, V value, Node<K,V> next) {
    return new Node<>(hash, key, value, next);
}
////newNode()å®Œæ¯•ï¼Œè¯·å›åˆ°<3>ç»§ç»­å‘ä¸‹
```

* å°ç»“ï¼šæ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶æˆ‘ä»¬è§£å†³ç¬¬ä¸€ç§æƒ…å†µï¼Œå³**å…ƒç´ ä½ç½®ä¸º`null`ç›´æ¥æ·»åŠ **ï¼Œè¿˜åº”è¯¥æŒæ¡ä¸€äº›ç»†èŠ‚ç‚¹ï¼è‹¥æ­¤æ—¶æ·»åŠ ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå‡è®¾å®ƒè®¡ç®—å‡ºæ¥çš„æ•°ç»„ä½ç½®ä¸ç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½®ä¸åŒï¼é‚£ä¹ˆè¯·ä½ å†å»èµ°ä¸€éæºç æµç¨‹å§ã€‚æ·»åŠ ä¸¤ä¸ªå…ƒç´ è¿‡åçš„å“ˆå¸Œè¡¨å¦‚å›¾

  ![1666438836421](assets/1666438836421.png)

------

â‘¢å‘HashMapæ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ 

* `map.put("ccc",333);`å‡è®¾ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ç›¸åŒ

```java
//Nodeå°±æ˜¯æ•°ç»„å†…é“¾è¡¨éƒ¨åˆ†
static class Node<K,V> implements Map.Entry<K,V> {
    final int hash;	//é”®çš„å“ˆå¸Œå€¼
    final K key;	//é”®
    V value;	//å€¼
    Node<K,V> next;	//ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
}
transient Node<K,V>[] table;//ä¿å­˜Entryå¯¹è±¡çš„æ•°ç»„
transient int size;//å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°
int threshold;//å“ˆå¸Œè¡¨çš„æ‰©å®¹æ—¶æœºï¼Œå€¼å°±æ˜¯æ•°ç»„é•¿åº¦*0.75ï¼Œèµ‹å€¼åœ¨resize()ä¸­å®Œæˆ
static final int TREEIFY_THRESHOLD = 8;

final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
    Node<K,V>[] tab;//å®šä¹‰å±€éƒ¨å˜é‡ç”¨æ¥è®°å½•å“ˆå¸Œè¡¨ä¸­æ•°ç»„çš„åœ°å€å€¼ 
    Node<K,V> p;//ä¸´æ—¶å˜é‡
    int n, i;//nè¡¨ç¤ºæ•°ç»„é•¿åº¦ï¼Œiè¡¨ç¤ºç´¢å¼•
    
    //è‹¥å“ˆå¸Œè¡¨æ•°ç»„ä¸ºç©º æˆ– å“ˆå¸Œè¡¨æ•°ç»„é•¿åº¦ä¸º0ï¼Œåˆ™åˆå§‹åŒ–æ•°ç»„æˆ–æ‰©å®¹	==æ­¤æ—¶ç¬¬ä¸‰æ¬¡æ·»åŠ å…ƒç´ tab!=nullä¸”n!=0ï¼Œä¸è¿›å…¥if
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;

    //è‹¥å½“å‰å…ƒç´ éœ€è¦æ’å…¥çš„ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥	==å‡è®¾ç¬¬ä¸‰ä¸ªå…ƒç´ ä¸ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ç›¸åŒï¼Œé‚£ä¹ˆæ­¤æ—¶p=ç¬¬ä¸€ä¸ªå…ƒç´ !=nullï¼Œæ‰€ä»¥è¿›å…¥else
    if ((p = tab[i = (n - 1) & hash]) == null)
        //åˆ›å»ºNodeèŠ‚ç‚¹ï¼Œç„¶åå°†è¯¥NodeèŠ‚ç‚¹æ·»åŠ åˆ°æ•°ç»„
        tab[i] = newNode(hash, key, value, null);
    else {
        //å½“å‰å…ƒç´ éœ€è¦æ’å…¥çš„ä½ç½®ä¸ä¸ºç©º
        
        Node<K,V> e; K k;
        //è‹¥æ’å…¥ç‚¹å·²å­˜åœ¨å…ƒç´ çš„å“ˆå¸Œå€¼ç­‰äºå½“å‰å…ƒç´ å“ˆå¸Œå€¼ && (äºŒè€…é”®åœ°å€å€¼ç›¸åŒ || é”®çš„å€¼ç›¸åŒ)ï¼Œè¡¨ç¤ºé”®é‡å¤ï¼Œè¿›å…¥ifä»¤eç­‰äºå½“å‰æ’å…¥ç‚¹å·²ç»å­˜åœ¨çš„å…ƒç´ 	==ç¬¬ä¸‰ä¸ªå…ƒç´ é”®ä¸ç›¸åŒï¼Œä¸ä¼šè¿›å…¥è¯¥if
        if (p.hash == hash && ((k = p.key) == key || (key != null && key.equals(k))))
            e = p;
        else if (p instanceof TreeNode)//TreeNodeæ˜¯çº¢é»‘æ ‘çš„å®ç°ï¼Œåˆ¤æ–­å½“å‰æ•°ç»„ä¸­å­˜çš„æ˜¯ä¸æ˜¯çº¢é»‘æ ‘ï¼Œè‹¥æ˜¯åˆ™å°†å°†è¯¥å…ƒç´ æ·»åŠ åˆ°çº¢é»‘æ ‘	==ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹æ·»åŠ æ—¶ä¸å±äºè¯¥æƒ…å†µï¼Œæ‰€ä»¥ä¸è¿›å…¥è¯¥else-if
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        else {//é€šè¿‡æ‹‰é“¾æ³•å‘é“¾è¡¨å°¾éƒ¨æ·»åŠ å…ƒç´ 	==æ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ æ—¶å±äºè¯¥æƒ…å†µï¼Œè¿›å…¥è¯¥else
            for (int binCount = 0; ; ++binCount) {
                //å°†pçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹èµ‹å€¼ç»™eï¼Œå…¶å®å°±æ˜¯ä»¤pç§»åŠ¨åˆ°é“¾è¡¨å°¾å…ƒç´ ä½ç½®	==æ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ æ—¶åˆšå¥½é“¾è¡¨ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿›å…¥è¯¥if
                if ((e = p.next) == null) {
                    //å‘é“¾è¡¨æœ€åæ·»åŠ æ–°å…ƒç´ 
                    p.next = newNode(hash, key, value, null);
                    
                    //åˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦åˆ°è¾¾8ï¼Œåˆ°è¾¾è¿›å…¥ifè¯­å¥	==æ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ æ—¶ä¸è¿›å…¥if
                    if (binCount >= TREEIFY_THRESHOLD - 1)
                        treeifyBin(tab, hash);//treeifyBinåº•å±‚è¿˜ä¼šç»§ç»­åˆ¤æ–­ï¼Œè‹¥æ•°ç»„é•¿åº¦å¤§äº64å°±ä¼šè½¬æˆçº¢é»‘æ ‘
                    //å…ƒç´ æˆåŠŸæ·»åŠ åˆ°é“¾è¡¨åè·³å‡ºè¯¥å¾ªç¯
                    break;
                }
                
                //æ¯æ¬¡ç§»åŠ¨é“¾è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œåˆ¤æ–­ä¸å½“å‰å…ƒç´ çš„é”®æ˜¯å¦é‡å¤ï¼Œé‡å¤åˆ™ä¸æ·»åŠ å…ƒç´ åˆ°é“¾è¡¨ï¼Œç›´æ¥è·³å‡ºå¾ªç¯ï¼Œæ­¤æ—¶eä¸ºé“¾è¡¨ä¸­ä¸å½“å‰å…ƒç´ é‡å¤çš„å…ƒç´ 
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    break;

                //pæŒ‡é’ˆå‘åç§»åŠ¨ï¼Œç»§ç»­åˆ¤æ–­
                p = e;
            }
        }

        //è‹¥eä¸ºç©ºè¡¨ç¤ºï¼Œè‹¥eä¸ä¸ºnullè¡¨ç¤ºå½“å‰å…ƒç´ ä¸æ•°ç»„å­˜çš„å…ƒç´ é”®é‡å¤æˆ–ä¸çº¢é»‘æ ‘ä¸­æŸå…ƒç´ é”®é‡å¤æˆ–ä¸é“¾è¡¨ä¸­æŸå…ƒç´ é”®é‡å¤ï¼Œä¸ç®¡å“ªç§æƒ…å†µï¼Œåªè¦e!=nullåˆ™eçš„å€¼è¡¨ç¤ºå·²å­˜åœ¨çš„é‡å¤çš„å…ƒç´ ï¼Œeè¡¨ç¤ºéœ€è¦è¢«è¦†ç›–çš„å…ƒç´ 	==ç¬¬ä¸‰ä¸ªå…ƒç´ e=nullï¼Œä¸è¿›å…¥if
        if (e != null) {
            V oldValue = e.value;
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;
            afterNodeAccess(e);
            return oldValue;
        }
    }
    ++modCount;//å…ˆä¸ç®¡
    
    //è‹¥å®é™…å…ƒç´ ä¸ªæ•°å¤§äºæ‰©å®¹æ—¶æœºï¼Œåˆ™éœ€è¦æ‰©å®¹
    if (++size > threshold)
        resize();
    
    //ä¸LinkedHashMapç›¸å…³ï¼Œå…ˆä¸ç®¡
    afterNodeInsertion(evict);
    
    //å½“å‰æ²¡æœ‰è¦†ç›–ä»»ä½•å…ƒç´ ï¼Œè¿”å›null
    return null;
}
//æ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ çš„putVal()å®Œæ¯•ï¼Œè¯·çœ‹æœ€åçš„å°ç»“éƒ¨åˆ†
```

* å°ç»“ï¼šæ·»åŠ ç¬¬ä¸‰ä¸ªå…ƒç´ æ—¶æˆ‘ä»¬è§£å†³ç¬¬ä¸‰ç§æƒ…å†µï¼Œå³**å…ƒç´ ä½ç½®ä¸ä¸º`null`ä¸”é”®ä¸é‡å¤ï¼Œåˆ™æŒ‚æ¥åœ¨é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸‹**ï¼Œè‹¥æ­¤æ—¶æ·»åŠ ç¬¬å››ä¸ªå…ƒç´ ï¼Œå‡è®¾å®ƒè®¡ç®—å‡ºæ¥çš„æ•°ç»„ä½ç½®ä¸ç¬¬ä¸€ä¸ªå…ƒç´ ä½ç½®ç›¸åŒï¼é‚£ä¹ˆè¯·ä½ å†å»èµ°ä¸€éæºç æµç¨‹å§ã€‚æ·»åŠ å››ä¸ªå…ƒç´ è¿‡åçš„å“ˆå¸Œè¡¨å¦‚å›¾

  ![1666438877896](assets/1666438877896.png)

------

â‘£å‘HashMapæ·»åŠ ç¬¬äº”ä¸ªå…ƒç´ 

- `map.put("ddd",555);`å‡è®¾ç¬¬äº”ä¸ªå…ƒç´ ä¸ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ç›¸åŒ

```java
//Nodeå°±æ˜¯æ•°ç»„å†…é“¾è¡¨éƒ¨åˆ†
static class Node<K,V> implements Map.Entry<K,V> {
    final int hash;	//é”®çš„å“ˆå¸Œå€¼
    final K key;	//é”®
    V value;	//å€¼
    Node<K,V> next;	//ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
}
transient Node<K,V>[] table;//ä¿å­˜Entryå¯¹è±¡çš„æ•°ç»„
transient int size;//å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°
int threshold;//å“ˆå¸Œè¡¨çš„æ‰©å®¹æ—¶æœºï¼Œå€¼å°±æ˜¯æ•°ç»„é•¿åº¦*0.75ï¼Œèµ‹å€¼åœ¨resize()ä¸­å®Œæˆ
static final int TREEIFY_THRESHOLD = 8;

final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
    Node<K,V>[] tab;//å®šä¹‰å±€éƒ¨å˜é‡ç”¨æ¥è®°å½•å“ˆå¸Œè¡¨ä¸­æ•°ç»„çš„åœ°å€å€¼ 
    Node<K,V> p;//ä¸´æ—¶å˜é‡
    int n, i;//nè¡¨ç¤ºæ•°ç»„é•¿åº¦ï¼Œiè¡¨ç¤ºç´¢å¼•
    
    //è‹¥å“ˆå¸Œè¡¨æ•°ç»„ä¸ºç©º æˆ– å“ˆå¸Œè¡¨æ•°ç»„é•¿åº¦ä¸º0ï¼Œåˆ™åˆå§‹åŒ–æ•°ç»„æˆ–æ‰©å®¹	==æ­¤æ—¶ç¬¬äº”æ¬¡æ·»åŠ å…ƒç´ tab!=nullä¸”n!=0ï¼Œä¸è¿›å…¥if
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length;

    //è‹¥å½“å‰å…ƒç´ éœ€è¦æ’å…¥çš„ä½ç½®ä¸ºç©ºï¼Œåˆ™ç›´æ¥æ’å…¥	==å‡è®¾ç¬¬äº”ä¸ªå…ƒç´ ä¸ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ç›¸åŒï¼Œé‚£ä¹ˆæ­¤æ—¶p=ç¬¬ä¸€ä¸ªå…ƒç´ !=nullï¼Œæ‰€ä»¥è¿›å…¥else
    if ((p = tab[i = (n - 1) & hash]) == null)
        //åˆ›å»ºNodeèŠ‚ç‚¹ï¼Œç„¶åå°†è¯¥NodeèŠ‚ç‚¹æ·»åŠ åˆ°æ•°ç»„
        tab[i] = newNode(hash, key, value, null);
    else {
        //å½“å‰å…ƒç´ éœ€è¦æ’å…¥çš„ä½ç½®ä¸ä¸ºç©º
        
        Node<K,V> e; K k;
        //è‹¥æ’å…¥ç‚¹å·²å­˜åœ¨å…ƒç´ çš„å“ˆå¸Œå€¼ç­‰äºå½“å‰å…ƒç´ å“ˆå¸Œå€¼ && (äºŒè€…é”®åœ°å€å€¼ç›¸åŒ || é”®çš„å€¼ç›¸åŒ)ï¼Œè¡¨ç¤ºé”®é‡å¤ï¼Œè¿›å…¥ifä»¤eç­‰äºå½“å‰æ’å…¥ç‚¹å·²ç»å­˜åœ¨çš„å…ƒç´ 	==ç¬¬äº”ä¸ªå…ƒç´ é”®ä¸pä¸ç›¸åŒï¼Œä¸ä¼šè¿›å…¥è¯¥if
        if (p.hash == hash && ((k = p.key) == key || (key != null && key.equals(k))))
            e = p;
        else if (p instanceof TreeNode)//TreeNodeæ˜¯çº¢é»‘æ ‘çš„å®ç°ï¼Œåˆ¤æ–­å½“å‰æ•°ç»„ä¸­å­˜çš„æ˜¯ä¸æ˜¯çº¢é»‘æ ‘ï¼Œè‹¥æ˜¯åˆ™å°†å°†è¯¥å…ƒç´ æ·»åŠ åˆ°çº¢é»‘æ ‘	==ç¬¬äº”ä¸ªèŠ‚ç‚¹æ·»åŠ æ—¶ä¸å±äºè¯¥æƒ…å†µï¼Œæ‰€ä»¥ä¸è¿›å…¥è¯¥else-if
            e = ((TreeNode<K,V>)p).putTreeVal(this, tab, hash, key, value);
        else {//é€šè¿‡æ‹‰é“¾æ³•å‘é“¾è¡¨å°¾éƒ¨æ·»åŠ å…ƒç´ 	==æ·»åŠ ç¬¬äº”ä¸ªå…ƒç´ æ—¶å±äºè¯¥æƒ…å†µï¼Œè¿›å…¥è¯¥else
            for (int binCount = 0; ; ++binCount) {
                //å°†pçš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹èµ‹å€¼ç»™eï¼Œå…¶å®å°±æ˜¯ä»¤pç§»åŠ¨åˆ°é“¾è¡¨å°¾å…ƒç´ ä½ç½®	==æ·»åŠ ç¬¬äº”ä¸ªå…ƒç´ æ—¶å­˜åœ¨ä¸€ä¸ªé”®é‡å¤çš„å…ƒç´ ï¼Œä¸ä¼šè¿›å…¥è¯¥if
                if ((e = p.next) == null) {
                    p.next = newNode(hash, key, value, null);
                    if (binCount >= TREEIFY_THRESHOLD - 1)
                        treeifyBin(tab, hash);
                    break;
                }
                
                //æ¯æ¬¡ç§»åŠ¨é“¾è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œåˆ¤æ–­ä¸å½“å‰å…ƒç´ çš„é”®æ˜¯å¦é‡å¤ï¼Œé‡å¤åˆ™ä¸æ·»åŠ å…ƒç´ åˆ°é“¾è¡¨ï¼Œç›´æ¥è·³å‡ºå¾ªç¯ï¼Œæ­¤æ—¶eä¸ºé“¾è¡¨ä¸­ä¸å½“å‰å…ƒç´ é‡å¤çš„å…ƒç´ 	==æ·»åŠ ç¬¬äº”ä¸ªå…ƒç´ æ—¶ä¼šå­˜åœ¨é‡å¤çš„æƒ…å†µï¼Œè¿›å…¥è¯¥ifè·³å‡ºå¾ªç¯ï¼Œæ­¤æ—¶eå°±æ˜¯é“¾è¡¨ä¸­ä¸å½“å‰å…ƒç´ é‡å¤çš„å…ƒç´ 
                if (e.hash == hash &&
                    ((k = e.key) == key || (key != null && key.equals(k))))
                    break;

                //pæŒ‡é’ˆå‘åç§»åŠ¨ï¼Œç»§ç»­åˆ¤æ–­
                p = e;
            }
        }

        //è‹¥eä¸ºç©ºè¡¨ç¤ºï¼Œè‹¥eä¸ä¸ºnullè¡¨ç¤ºå½“å‰å…ƒç´ ä¸æ•°ç»„å­˜çš„å…ƒç´ é”®é‡å¤æˆ–ä¸çº¢é»‘æ ‘ä¸­æŸå…ƒç´ é”®é‡å¤æˆ–ä¸é“¾è¡¨ä¸­æŸå…ƒç´ é”®é‡å¤ï¼Œä¸ç®¡å“ªç§æƒ…å†µï¼Œåªè¦e!=nullåˆ™eçš„å€¼è¡¨ç¤ºå·²å­˜åœ¨çš„é‡å¤çš„å…ƒç´ ï¼Œeè¡¨ç¤ºéœ€è¦è¢«è¦†ç›–çš„å…ƒç´ 	==ç¬¬äº”ä¸ªå…ƒç´ e!=nullï¼Œä¸è¿›å…¥if
        if (e != null) {
            V oldValue = e.value;//è¦è¢«è¦†ç›–çš„å…ƒç´ çš„å€¼	==æ­¤æ—¶æ˜¯444
            //onlyIfAbsentæ˜¯ä¼ å…¥çš„å‚æ•°ï¼Œè‹¥éœ€è¦è¢«è¦†ç›–åˆ™è¿›å…¥if	==ä¼ é€’çš„å‚æ•°æ˜¯falseï¼Œè¿›å…¥è¯¥if
            if (!onlyIfAbsent || oldValue == null)
                e.value = value;//eçš„å€¼æ›¿æ¢æˆæ–°å€¼	==è¢«æ›¿æ¢æˆ555
            afterNodeAccess(e);
            return oldValue;//å°†æ—§çš„å€¼è¿”å›ï¼Œç»“æŸæ–¹æ³•	==è¿”å›444

            //é€šè¿‡è¯»è¿™ä¸€æ®µæºç ï¼Œæˆ‘ä»¬ç›´åˆ°å…¶å®ä¸æ˜¯å°†è€çš„é”®å€¼å¯¹ç›´æ¥æ›¿æ¢ï¼Œè€Œæ˜¯ä¿®æ”¹è€çš„é”®å€¼å¯¹ä¸­çš„å€¼è€Œå·²
        }
    }
    ++modCount;//å…ˆä¸ç®¡
    
    //è‹¥å®é™…å…ƒç´ ä¸ªæ•°å¤§äºæ‰©å®¹æ—¶æœºï¼Œåˆ™éœ€è¦æ‰©å®¹
    if (++size > threshold)
        resize();
    
    //ä¸LinkedHashMapç›¸å…³ï¼Œå…ˆä¸ç®¡
    afterNodeInsertion(evict);
    
    return null;
}
//æ·»åŠ ç¬¬äº”ä¸ªå…ƒç´ çš„putVal()å®Œæ¯•ï¼Œè¯·çœ‹æœ€åçš„å°ç»“éƒ¨åˆ†
```

* å°ç»“ï¼šæ·»åŠ ç¬¬äº”ä¸ªå…ƒç´ æ—¶æˆ‘ä»¬è§£å†³ç¬¬äºŒç§æƒ…å†µï¼Œå³**å…ƒç´ ä½ç½®ä¸ä¸º`null`ä¸”é”®é‡å¤ï¼Œåˆ™å…ƒç´ è¦†ç›–**ï¼Œæ³¨æ„è¦†ç›–çš„å…¶å®æ˜¯å€¼ã€‚æ·»åŠ äº”ä¸ªå…ƒç´ è¿‡åçš„å“ˆå¸Œè¡¨å¦‚å›¾

  ![1666438914408](assets/1666438914408.png)

------

â‘¤ä»¥ä¸Šå…¶å®è¿˜æœ‰ä¸¤ä¸ªæ–¹æ³•æ²¡æœ‰æåŠï¼Œå³å‘çº¢é»‘æ ‘ä¸­æ·»åŠ å…ƒç´ å’Œé“¾è¡¨è½¬çº¢é»‘æ ‘ï¼Œæ­¤å¤„æ”¾å‡ºæºç ï¼Œæš‚æ—¶å…ˆä¸å­¦ä¹ 

```java
static final class TreeNode<K,V> extends LinkedHashMap.Entry<K,V> {
    TreeNode<K,V> parent;	//çˆ¶èŠ‚ç‚¹
    TreeNode<K,V> left;	//å·¦å­èŠ‚ç‚¹
    TreeNode<K,V> right;	//å³å­èŠ‚ç‚¹
    TreeNode<K,V> prev;	//needed to unlink next upon deletion
    boolean red;	//èŠ‚ç‚¹çš„é¢œè‰²ï¼Œtrueè¡¨ç¤ºçº¢è‰²
    //ç»§æ‰¿Nodeï¼Œæ‰€ä»¥è¿˜å­˜äº†å“ˆå¸Œå€¼ï¼Œé”®å’Œå€¼
}

final TreeNode<K,V> putTreeVal(HashMap<K,V> map, Node<K,V>[] tab,
                               int h, K k, V v) {
    Class<?> kc = null;
    boolean searched = false;
    TreeNode<K,V> root = (parent != null) ? root() : this;
    for (TreeNode<K,V> p = root;;) {
        int dir, ph; K pk;
        if ((ph = p.hash) > h)
            dir = -1;
        else if (ph < h)
            dir = 1;
        else if ((pk = p.key) == k || (k != null && k.equals(pk)))
            return p;
        else if ((kc == null &&
                  (kc = comparableClassFor(k)) == null) ||
                 (dir = compareComparables(kc, k, pk)) == 0) {
            if (!searched) {
                TreeNode<K,V> q, ch;
                searched = true;
                if (((ch = p.left) != null &&
                     (q = ch.find(h, k, kc)) != null) ||
                    ((ch = p.right) != null &&
                     (q = ch.find(h, k, kc)) != null))
                    return q;
            }
            dir = tieBreakOrder(k, pk);
        }

        TreeNode<K,V> xp = p;
        if ((p = (dir <= 0) ? p.left : p.right) == null) {
            Node<K,V> xpn = xp.next;
            TreeNode<K,V> x = map.newTreeNode(h, k, v, xpn);
            if (dir <= 0)
                xp.left = x;
            else
                xp.right = x;
            xp.next = x;
            x.parent = x.prev = xp;
            if (xpn != null)
                ((TreeNode<K,V>)xpn).prev = x;
            moveRootToFront(tab, balanceInsertion(root, x));
            return null;
        }
    }
}
```

```java
final void treeifyBin(Node<K,V>[] tab, int hash) {
    int n, index; Node<K,V> e;
    if (tab == null || (n = tab.length) < MIN_TREEIFY_CAPACITY)
        resize();
    else if ((e = tab[index = (n - 1) & hash]) != null) {
        TreeNode<K,V> hd = null, tl = null;
        do {
            TreeNode<K,V> p = replacementTreeNode(e, null);
            if (tl == null)
                hd = p;
            else {
                p.prev = tl;
                tl.next = p;
            }
            tl = p;
        } while ((e = e.next) != null);
        if ((tab[index] = hd) != null)
            hd.treeify(tab);
    }
}
```

### 4.LinkedHashMapé›†åˆ

ä¸éœ€è¦å­¦ä¹ æ–°å¢çš„æ–¹æ³•ï¼ŒLinkedHashSetçš„åº•å±‚å®é™…å°±æ˜¯LinkedHashMapï¼Œçœ‹æºç å¯çŸ¥ï¼Œæ‰€ä»¥å…¶ç‰¹ç‚¹ä¸º**æœ‰åº**ã€ä¸é‡å¤ã€æ— ç´¢å¼•ï¼Œå…¶ä¸­æœ‰åº**åªæ˜¯åœ¨å“ˆå¸Œè¡¨çš„åŸºç¡€ä¸Šåˆæ–°å¢äº†åŒé“¾è¡¨æœºåˆ¶è®°å½•å­˜å‚¨çš„é¡ºåº**ï¼Œåœ¨éå†æ—¶å®é™…ä¸Šéå†çš„æ˜¯åŒå‘é“¾è¡¨

![1664713570299](assets/1664713570299.png)

### 5.TreeMapé›†åˆ

#### 5.1.TreeMapç‰¹ç‚¹

TreeMapçš„ç‰¹ç‚¹æ˜¯**å¯æ’åº**ã€ä¸é‡å¤ã€æ— ç´¢å¼•ï¼Œæ’åºè§„åˆ™å¦‚ä¸‹

- å¯¹äºåŒ…è£…ç±»ï¼Œé»˜è®¤ä»å°åˆ°å¤§æ’åº
- å¯¹äºå­—ç¬¦ä¸²ï¼Œé»˜è®¤ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹æ¯”è¾ƒASCIIè¡¨ç›¸åº”çš„å€¼
- å¯¹äºè‡ªå®šä¹‰çš„ç±»ï¼Œéœ€è¦å®ç°Comparableæ¥å£ï¼Œé‡å†™`compareTo()`å®ç°æ’åºè§„åˆ™

TreeMapçš„åº•å±‚åŸç†å’ŒTreeSetç›¸åŒï¼Œåº•å±‚åŸºäº**çº¢é»‘æ ‘**å®ç°æ’åºï¼Œå¢åˆ æ”¹æŸ¥æ€§èƒ½éƒ½æ¯”è¾ƒå¥½

> HashTableå’ŒPropertiesä¸­å­˜åœ¨IOç›¸å…³çŸ¥è¯†ï¼Œå¯å­¦ä¹ å®ŒIOåå†æ¥çœ‹è¯¥éƒ¨åˆ†

#### 5.2.TreeMapæºç 





























